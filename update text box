import pandas as pd
import string
import spacy

# Load SpaCy English model
nlp = spacy.load('en_core_web_sm')

# Sample DataFrame with metadata
data = {
    'Product': ['Apple iPhone 13', 'Samsung Galaxy S21', 'Google Pixel 6'],
    'Price': [999, 899, 799],
    'Release Year': [2021, 2021, 2021],
    'Description': ['Latest iPhone model', 'Flagship Samsung phone', 'Google\'s newest Pixel']
}
df = pd.DataFrame(data)

# Preprocess metadata
metadata = {
    'Product': 'product name',
    'Price': 'price',
    'Release Year': 'release year',
    'Description': 'description'
}

# Function to extract relevant entities from user query using SpaCy
def extract_entities(query):
    doc = nlp(query)
    entities = [ent.text.lower() for ent in doc.ents if ent.label_ in ['PRODUCT', 'DATE']]  # Extract product names and dates
    return entities

# Function to map query to dataframe columns
def map_query_to_column(query):
    entities = extract_entities(query)
    for entity in entities:
        if entity in metadata.values():
            for key, value in metadata.items():
                if value == entity:
                    return key
    return None

# Function to get value based on user query
def get_value_based_on_query(query):
    column = map_query_to_column(query)
    if column:
        relevant_data = df[column].values.tolist()
        return relevant_data
    else:
        return "Sorry, I couldn't understand your query."

# Example usage
user_query = "What is the price of the latest Samsung phone?"
value = get_value_based_on_query(user_query)
print("Response:", value)
